<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®¡ç†åå° - å£°èˆªéŸ³ä¹</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <!-- å¯¼èˆªæ  -->
    <nav class="navbar">
        <a href="index.html" class="logo">ğŸµ å£°èˆªéŸ³ä¹</a>
        <div class="nav-links">
            <a href="index.html">é¦–é¡µ</a>
            <a href="music.html">éŸ³ä¹ä¸­å¿ƒ</a>
            <a href="songlist.html">æˆ‘çš„æ­Œå•</a>
            <a href="favorites.html">æˆ‘çš„æ”¶è—</a>
            <a href="history.html">æ’­æ”¾è®°å½•</a>
            <a href="profile.html">ä¸ªäººä¸­å¿ƒ</a>
            <a href="admin.html" class="active">ç®¡ç†åå°</a>
        </div>
        <div class="user-info">
            <span id="welcomeText">åŠ è½½ä¸­...</span>
            <button class="logout-btn" onclick="handleLogout()">é€€å‡ºç™»å½•</button>
        </div>
    </nav>

    <!-- ä¸»å†…å®¹ -->
    <div class="container">
        <div id="alertBox"></div>
        
        <div class="card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
            <h2>ğŸ› ï¸ ç®¡ç†å‘˜åå°</h2>
            <p style="margin-top: 10px; opacity: 0.9;">æ¬¢è¿ç®¡ç†å‘˜ï¼æ‚¨å¯ä»¥åœ¨æ­¤ç®¡ç†æ­Œæ‰‹ã€ä¸“è¾‘å’Œæ­Œæ›²ä¿¡æ¯ã€‚</p>
        </div>
        
        <!-- æ ‡ç­¾é¡µ -->
        <div class="tabs">
            <button class="tab active" onclick="switchTab('singer')">ğŸ¤ æ­Œæ‰‹ç®¡ç†</button>
            <button class="tab" onclick="switchTab('album')">ğŸ’¿ ä¸“è¾‘ç®¡ç†</button>
            <button class="tab" onclick="switchTab('song')">ğŸµ æ­Œæ›²ç®¡ç†</button>
        </div>
        
        <!-- æ­Œæ‰‹ç®¡ç†é¢æ¿ -->
        <div id="singerPanel">
            <div class="card">
                <h3 class="card-title">â• æ·»åŠ æ­Œæ‰‹</h3>
                <form id="addSingerForm">
                    <div class="form-group">
                        <label>æ­Œæ‰‹åç§° *</label>
                        <input type="text" id="singerName" placeholder="è¯·è¾“å…¥æ­Œæ‰‹åç§°" required>
                    </div>
                    <div class="form-group">
                        <label>æ­Œæ‰‹ç±»å‹ *</label>
                        <select id="singerType" required>
                            <option value="ç”·">ç”·</option>
                            <option value="å¥³">å¥³</option>
                            <option value="ç»„åˆ">ç»„åˆ</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>å›½ç±</label>
                        <input type="text" id="singerCountry" placeholder="è¯·è¾“å…¥å›½ç±">
                    </div>
                    <div class="form-group">
                        <label>ç”Ÿæ—¥</label>
                        <input type="date" id="singerBirthday">
                    </div>
                    <div class="form-group">
                        <label>æ­Œæ‰‹ç®€ä»‹</label>
                        <textarea id="singerIntroduction" placeholder="è¯·è¾“å…¥æ­Œæ‰‹ç®€ä»‹" style="height: 100px;"></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary">æ·»åŠ æ­Œæ‰‹</button>
                </form>
            </div>
            
            <div class="card">
                <h3 class="card-title">ğŸ—‘ï¸ åˆ é™¤æ­Œæ‰‹</h3>
                <form id="deleteSingerForm">
                    <div class="form-group">
                        <label>æ­Œæ‰‹ID *</label>
                        <input type="number" id="deleteSingerId" placeholder="è¯·è¾“å…¥æ­Œæ‰‹ID" required>
                    </div>
                    <div class="form-group">
                        <label>æ­Œæ‰‹åç§° * (ç¡®è®¤ç”¨)</label>
                        <input type="text" id="deleteSingerName" placeholder="è¯·è¾“å…¥æ­Œæ‰‹åç§°ç¡®è®¤" required>
                    </div>
                    <button type="submit" class="btn btn-danger">åˆ é™¤æ­Œæ‰‹</button>
                </form>
            </div>
        </div>
        
        <!-- ä¸“è¾‘ç®¡ç†é¢æ¿ -->
        <div id="albumPanel" style="display: none;">
            <div class="card">
                <h3 class="card-title">â• æ·»åŠ ä¸“è¾‘</h3>
                <form id="addAlbumForm">
                    <div class="form-group">
                        <label>ä¸“è¾‘åç§° *</label>
                        <input type="text" id="albumTitle" placeholder="è¯·è¾“å…¥ä¸“è¾‘åç§°" required>
                    </div>
                    <div class="form-group">
                        <label>æ‰€å±æ­Œæ‰‹ID *</label>
                        <input type="number" id="albumSingerId" placeholder="è¯·è¾“å…¥æ­Œæ‰‹ID" required>
                    </div>
                    <div class="form-group">
                        <label>å‘è¡Œæ—¥æœŸ</label>
                        <input type="date" id="albumReleaseDate">
                    </div>
                    <div class="form-group">
                        <label>å°é¢URL</label>
                        <input type="text" id="albumCoverUrl" placeholder="è¯·è¾“å…¥å°é¢å›¾ç‰‡URL">
                    </div>
                    <div class="form-group">
                        <label>ä¸“è¾‘æè¿°</label>
                        <textarea id="albumDescription" placeholder="è¯·è¾“å…¥ä¸“è¾‘æè¿°" style="height: 100px;"></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary">æ·»åŠ ä¸“è¾‘</button>
                </form>
            </div>
            
            <div class="card">
                <h3 class="card-title">ğŸ—‘ï¸ åˆ é™¤ä¸“è¾‘</h3>
                <form id="deleteAlbumForm">
                    <div class="form-group">
                        <label>ä¸“è¾‘ID *</label>
                        <input type="number" id="deleteAlbumId" placeholder="è¯·è¾“å…¥ä¸“è¾‘ID" required>
                    </div>
                    <button type="submit" class="btn btn-danger">åˆ é™¤ä¸“è¾‘</button>
                </form>
            </div>
        </div>
        
        <!-- æ­Œæ›²ç®¡ç†é¢æ¿ -->
        <div id="songPanel" style="display: none;">
            <div class="card">
                <h3 class="card-title">â• æ·»åŠ æ­Œæ›²</h3>
                <form id="addSongForm">
                    <div class="form-group">
                        <label>æ­Œæ›²åç§° *</label>
                        <input type="text" id="songTitle" placeholder="è¯·è¾“å…¥æ­Œæ›²åç§°" required>
                    </div>
                    <div class="form-group">
                        <label>æ‰€å±ä¸“è¾‘ID *</label>
                        <input type="number" id="songAlbumId" placeholder="è¯·è¾“å…¥ä¸“è¾‘ID" required>
                    </div>
                    <div class="form-group">
                        <label>æ­Œæ‰‹IDåˆ—è¡¨ * (å¤šä¸ªç”¨é€—å·åˆ†éš”)</label>
                        <input type="text" id="songSingersId" placeholder="ä¾‹å¦‚: 1,2,3" required>
                    </div>
                    <div class="form-group">
                        <label>æ­Œæ›²æ—¶é•¿ * (æ ¼å¼: mm:ss)</label>
                        <input type="text" id="songDuration" placeholder="ä¾‹å¦‚: 4:30" required pattern="\d+:\d{2}">
                    </div>
                    <div class="form-group">
                        <label>éŸ³é¢‘æ–‡ä»¶è·¯å¾„ *</label>
                        <input type="text" id="songFileUrl" placeholder="è¯·è¾“å…¥éŸ³é¢‘æ–‡ä»¶è·¯å¾„" required>
                    </div>
                    <button type="submit" class="btn btn-primary">æ·»åŠ æ­Œæ›²</button>
                </form>
            </div>
            
            <div class="card">
                <h3 class="card-title">ğŸ—‘ï¸ åˆ é™¤æ­Œæ›²</h3>
                <form id="deleteSongForm">
                    <div class="form-group">
                        <label>æ­Œæ›²ID *</label>
                        <input type="number" id="deleteSongId" placeholder="è¯·è¾“å…¥æ­Œæ›²ID" required>
                    </div>
                    <button type="submit" class="btn btn-danger">åˆ é™¤æ­Œæ›²</button>
                </form>
            </div>
        </div>
    </div>

    <script src="js/api.js"></script>
    <script>
        // æ£€æŸ¥ç™»å½•çŠ¶æ€å’Œç®¡ç†å‘˜æƒé™
        // æ³¨æ„ï¼šè¿™åªæ˜¯å‰ç«¯UIä¿æŠ¤ï¼Œæ‰€æœ‰ç®¡ç†å‘˜æ“ä½œéƒ½å¿…é¡»åœ¨åç«¯è¿›è¡Œæƒé™éªŒè¯
        // åç«¯çš„ require_admin() å‡½æ•°ä¼šéªŒè¯å®é™…çš„ç®¡ç†å‘˜æƒé™
        if (!UserStore.isLoggedIn()) {
            window.location.href = 'login.html';
        }
        
        if (!UserStore.isAdmin()) {
            alert('æ‚¨æ²¡æœ‰ç®¡ç†å‘˜æƒé™ï¼');
            window.location.href = 'index.html';
        }
        
        let currentTab = 'singer';
        
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('welcomeText').textContent = 'ç®¡ç†å‘˜ï¼š' + UserStore.getUsername();
        });
        
        // åˆ‡æ¢æ ‡ç­¾é¡µ
        function switchTab(tab) {
            currentTab = tab;
            
            // æ›´æ–°æ ‡ç­¾æ ·å¼
            document.querySelectorAll('.tab').forEach((t, index) => {
                t.classList.remove('active');
                if ((tab === 'singer' && index === 0) ||
                    (tab === 'album' && index === 1) ||
                    (tab === 'song' && index === 2)) {
                    t.classList.add('active');
                }
            });
            
            // éšè—æ‰€æœ‰é¢æ¿
            document.getElementById('singerPanel').style.display = 'none';
            document.getElementById('albumPanel').style.display = 'none';
            document.getElementById('songPanel').style.display = 'none';
            
            // æ˜¾ç¤ºå¯¹åº”é¢æ¿
            document.getElementById(tab + 'Panel').style.display = 'block';
        }
        
        // ==================== æ­Œæ‰‹ç®¡ç† ====================
        document.getElementById('addSingerForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const data = {
                singer_name: document.getElementById('singerName').value.trim(),
                type: document.getElementById('singerType').value
            };
            
            const country = document.getElementById('singerCountry').value.trim();
            const birthday = document.getElementById('singerBirthday').value;
            const introduction = document.getElementById('singerIntroduction').value.trim();
            
            if (country) data.country = country;
            if (birthday) data.birthday = birthday;
            if (introduction) data.introduction = introduction;
            
            try {
                const result = await MusicAPI.adminAddSinger(data);
                showAlert(result.message || 'æ­Œæ‰‹æ·»åŠ æˆåŠŸï¼', 'success');
                document.getElementById('addSingerForm').reset();
            } catch (error) {
                showAlert(error.error || 'æ·»åŠ å¤±è´¥', 'error');
            }
        });
        
        document.getElementById('deleteSingerForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const singerId = document.getElementById('deleteSingerId').value;
            const singerName = document.getElementById('deleteSingerName').value.trim();
            
            if (!confirm(`ç¡®å®šè¦åˆ é™¤æ­Œæ‰‹ "${singerName}" (ID: ${singerId}) å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼`)) {
                return;
            }
            
            try {
                const result = await MusicAPI.adminDeleteSinger(singerId, singerName);
                showAlert(result.message || 'æ­Œæ‰‹åˆ é™¤æˆåŠŸï¼', 'success');
                document.getElementById('deleteSingerForm').reset();
            } catch (error) {
                showAlert(error.error || 'åˆ é™¤å¤±è´¥', 'error');
            }
        });
        
        // ==================== ä¸“è¾‘ç®¡ç† ====================
        document.getElementById('addAlbumForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const data = {
                album_title: document.getElementById('albumTitle').value.trim(),
                singer_id: parseInt(document.getElementById('albumSingerId').value)
            };
            
            const releaseDate = document.getElementById('albumReleaseDate').value;
            const coverUrl = document.getElementById('albumCoverUrl').value.trim();
            const description = document.getElementById('albumDescription').value.trim();
            
            if (releaseDate) data.release_date = releaseDate;
            if (coverUrl) data.cover_url = coverUrl;
            if (description) data.description = description;
            
            try {
                const result = await MusicAPI.adminAddAlbum(data);
                showAlert(result.message || 'ä¸“è¾‘æ·»åŠ æˆåŠŸï¼', 'success');
                document.getElementById('addAlbumForm').reset();
            } catch (error) {
                showAlert(error.error || 'æ·»åŠ å¤±è´¥', 'error');
            }
        });
        
        document.getElementById('deleteAlbumForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const albumId = document.getElementById('deleteAlbumId').value;
            
            if (!confirm(`ç¡®å®šè¦åˆ é™¤ä¸“è¾‘ (ID: ${albumId}) å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼`)) {
                return;
            }
            
            try {
                const result = await MusicAPI.adminDeleteAlbum(albumId);
                showAlert(result.message || 'ä¸“è¾‘åˆ é™¤æˆåŠŸï¼', 'success');
                document.getElementById('deleteAlbumForm').reset();
            } catch (error) {
                showAlert(error.error || 'åˆ é™¤å¤±è´¥', 'error');
            }
        });
        
        // ==================== æ­Œæ›²ç®¡ç† ====================
        document.getElementById('addSongForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const singersIdStr = document.getElementById('songSingersId').value.trim();
            const singersId = singersIdStr.split(',').map(s => parseInt(s.trim())).filter(n => !isNaN(n));
            
            if (singersId.length === 0) {
                showAlert('è¯·è¾“å…¥æœ‰æ•ˆçš„æ­Œæ‰‹ID', 'error');
                return;
            }
            
            const data = {
                song_title: document.getElementById('songTitle').value.trim(),
                album_id: parseInt(document.getElementById('songAlbumId').value),
                singers_id: singersId,
                duration: document.getElementById('songDuration').value.trim(),
                file_url: document.getElementById('songFileUrl').value.trim()
            };
            
            try {
                const result = await MusicAPI.adminAddSong(data);
                showAlert(result.message || 'æ­Œæ›²æ·»åŠ æˆåŠŸï¼', 'success');
                document.getElementById('addSongForm').reset();
            } catch (error) {
                showAlert(error.error || 'æ·»åŠ å¤±è´¥', 'error');
            }
        });
        
        document.getElementById('deleteSongForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const songId = document.getElementById('deleteSongId').value;
            
            if (!confirm(`ç¡®å®šè¦åˆ é™¤æ­Œæ›² (ID: ${songId}) å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼`)) {
                return;
            }
            
            try {
                const result = await MusicAPI.adminDeleteSong(songId);
                showAlert(result.message || 'æ­Œæ›²åˆ é™¤æˆåŠŸï¼', 'success');
                document.getElementById('deleteSongForm').reset();
            } catch (error) {
                showAlert(error.error || 'åˆ é™¤å¤±è´¥', 'error');
            }
        });
        
        function showAlert(message, type) {
            const alertBox = document.getElementById('alertBox');
            alertBox.innerHTML = `<div class="alert alert-${type}">${message}</div>`;
            setTimeout(() => alertBox.innerHTML = '', 3000);
        }
    </script>
</body>
</html>
