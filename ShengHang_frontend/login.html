<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç™»å½• - å£°èˆªéŸ³ä¹</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="auth-container">
        <div class="auth-card">
            <h1>ğŸµ å£°èˆªéŸ³ä¹</h1>
            <p class="subtitle">æ¬¢è¿å›æ¥ï¼Œè¯·ç™»å½•æ‚¨çš„è´¦å·</p>
            
            <div id="alertBox"></div>
            
            <form id="loginForm">
                <div class="form-group">
                    <label for="username">ç”¨æˆ·å</label>
                    <input type="text" id="username" name="username" placeholder="è¯·è¾“å…¥ç”¨æˆ·å" required>
                </div>
                
                <div class="form-group">
                    <label for="password">å¯†ç </label>
                    <input type="password" id="password" name="password" placeholder="è¯·è¾“å…¥å¯†ç " required>
                </div>
                
                <button type="submit" class="btn btn-primary">ç™» å½•</button>
            </form>
            
            <div class="links">
                <p>è¿˜æ²¡æœ‰è´¦å·ï¼Ÿ<a href="register.html">ç«‹å³æ³¨å†Œ</a></p>
            </div>
        </div>
    </div>

    <script src="js/api.js"></script>
    <script>
        // å¦‚æœå·²ç™»å½•ï¼Œè·³è½¬åˆ°é¦–é¡µ
        if (UserStore.isLoggedIn()) {
            window.location.href = 'index.html';
        }

        document.getElementById('loginForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value;
            
            if (!username || !password) {
                showAlert('è¯·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ', 'error');
                return;
            }
            
            try {
                const result = await UserAPI.login(username, password);
                
                // ä¿å­˜ç”¨æˆ·ä¿¡æ¯
                UserStore.setUser(result.user_id, result.username, result.is_admin);
                
                showAlert('ç™»å½•æˆåŠŸï¼æ­£åœ¨è·³è½¬...', 'success');
                
                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 1000);
                
            } catch (error) {
                showAlert(error.error || 'ç™»å½•å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç”¨æˆ·åå’Œå¯†ç ', 'error');
            }
        });
        
        function showAlert(message, type) {
            const alertBox = document.getElementById('alertBox');
            alertBox.innerHTML = `<div class="alert alert-${type}">${message}</div>`;
            
            if (type !== 'error') {
                setTimeout(() => {
                    alertBox.innerHTML = '';
                }, 3000);
            }
        }
    </script>
</body>
</html>
